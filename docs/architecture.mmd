classDiagram
<<<<<<< HEAD
class Main {
  -navigator : SceneController
  +start(Stage stage) : void
  +main(String[] args) : void
}
class DatabaseConfig {
  -connection : Connection
  -url : String
  -connection : return
  -val : String
  -val : return
  +close() : void
  -getEnv(String key) : String
}
class GameSettings 

class Difficulty {
  -ballSpeedMultiplier : return
  -paddleWidthMultiplier : return
  -soundEnabled : boolean
  -masterVolume : double
  -musicVolume : double
  -sfxVolume : double
  -difficulty : Difficulty
  -highScore : int
  -soundEnabled : return
  -masterVolume : return
  -musicVolume : return
  -sfxVolume : return
  -difficulty : return
  +ballSpeedMultiplier() : double
  +paddleWidthMultiplier() : double
  #GameSettings() : private
  -clamp01(double value) : double
}
class AppContext {
  -instance : AppContext
  -currentUser : User
  -instance : return
  +db() : DatabaseService
}
class Container {
  -instance : Container
  -paddleWidth : double
  -bricksSvc : BricksService
  -ballSvc : BallService
  -paddleSvc : PaddleService
  -sound : SoundManager
  -powerUpSvc : PowerUpService
  -enemySvc : EnemyService
  -bulletSvc : BulletService
  -roundSvc : RoundService
}
class GameController {
  -ballsRenderer : BallsRenderer
  -paddleRenderer : PaddleRenderer
  -bricksRenderer : BricksRenderer
  -powerUpRenderer : PowerUpRenderer
  -bulletRenderer : BulletRenderer
  -lifeRenderer : LifeRenderer
  -enemyRenderer : EnemyRenderer
  -doorTopRenderer : DoorTopRenderer
  -loop : AnimationTimer
  -levelIntroSequence : SequentialTransition
  -pauseOverlay : Parent
  -lastLevelObserved : int
  -spawnTimer : Timeline
  -doorType : DoorType
  -last : long
  -dt : double
  -in : InputState
  -u : User
  -bestRound : int
  -bestScore : int
  -left : boolean
  -in : return
  -code : KeyCode
  -pause : PauseTransition
  -nextLevel : int
  -currentLevel : int
  -showLevel : PauseTransition
  -countdown3 : PauseTransition
  -countdown2 : PauseTransition
  -countdown1 : PauseTransition
  -pt : PauseTransition
  -isCountdown : boolean
  -isCleared : boolean
  -pt : return
  -ft : FadeTransition
  -three : PauseTransition
  -two : PauseTransition
  -one : PauseTransition
  -seq : SequentialTransition
  -snap : GameStateSnapshot
  -username : String
  -loader : FXMLLoader
  +initialize() : void
  -startGameLoop() : void
  +handle(long now) : void
  -startEnemySpawnTimer() : void
  -readInput() : InputState
  -setupInputHandlers() : void
  -handlePauseButton() : void
  -handleGlobalKeyPressed(KeyEvent event) : void
  -handleGameKeyPressed(KeyEvent event) : void
  -registerEventListeners() : void
  -onLevelCleared(LevelClearedEvent event) : void
  -trackLevelTransition() : void
  -startLevelIntro() : void
  -createBannerStep(String text, double seconds) : PauseTransition
  -togglePause() : void
  #showPauseMenu() : else
  -showPauseMenu() : void
  -hidePauseMenu() : void
  -resumeGame() : void
  -restartLevel() : void
  -exitToMenu() : void
  -setupRenderers() : void
  -updateHud() : void
  -loadAndDisplayHighScore() : void
  -setupPauseOverlay() : void
  -stopLoopAndNavigate(SceneId target, TransitionStrategy transition) : void
  +stop() : void
  +applySnapshot(GameStateSnapshot snapshot) : void
  +resumeWithCountdown() : void
  +captureSnapshot() : GameStateSnapshot
}
class GameOverController {
  -initialize() : void
  +onPlayAgain(ActionEvent e) : void
  +onMainMenu(ActionEvent e) : void
}
class LoginController {
  -show : boolean
  -password : String
  -uname : String
  -cause : Throwable
  -onLogin() : void
  -showMessage(String text) : void
}
class MenuController {
  -animator : MenuAnimator
  -ordered : List<Button>
  -tries : int
  -selected : Button
  -current : User
  -user : User
  -setupKeyHandler(Scene scene) : void
  -updateContinueAvailability() : void
}
class PauseController {
  -onResume() : void
  -onRestart() : void
  -onExitToMenu() : void
}
class RankingsController {
  -rows : ObservableList<RankingRow>
  -rank : int
  -rows : return
  -toRows(List<RankingEntry> entries) : ObservableList<RankingRow>
  #RankingRow(int rank, String name, int score, int round) : public
}
class SceneController {
  -activeGameController : GameController
  -transitionManager : return
  -scene : Scene
  -container : Container
  -path : String
  -round : int
  -app : com.game.arkanoid.container.AppContext
  -u : com.game.arkanoid.models.User
  -snap : com.game.arkanoid.models.GameStateSnapshot
  -parent : Parent
  -controller : Object
  -parent : return
  +transitions() : TransitionManager
  +navigateTo(SceneId sceneId, TransitionStrategy transition) : void
  -setScene(SceneId sceneId, Parent root, TransitionStrategy transition) : void
  -stopActiveGame() : void
  +showMenu() : void
  -showMenu(TransitionStrategy transition) : void
  #buildUnknownController(cls) : throw
  +showSettings() : void
  -showSettings(TransitionStrategy transition) : void
  +showRankings() : void
  -showRankings(TransitionStrategy transition) : void
  +showLogin() : void
  -showLogin(TransitionStrategy transition) : void
  +showSignup() : void
  -showSignup(TransitionStrategy transition) : void
  +showGame() : void
  -showGame(TransitionStrategy transition) : void
  +showGameRound(int round) : void
  +showGameOver() : void
  -showGameOver(TransitionStrategy transition) : void
  +showWin() : void
  -showWin(TransitionStrategy transition) : void
  +continueGame() : void
  +startGameFromSnapshot(com.game.arkanoid.models.GameStateSnapshot snapshot) : void
  +saveInProgressIfAny() : void
  +exit() : void
  -load(String resource, Consumer<FXMLLoader> configurer) : Parent
  -buildUnknownController(Class<?> cls) : RuntimeException
}
class SceneId 

class SettingsController {

  -difficultyCombo : ComboBox<Difficulty>
  -masterSlider : Slider
  -musicSlider : Slider
  -sfxSlider : Slider
  -previousMasterVolume : double
  -selected : Difficulty
  -onDifficultyChanged(ActionEvent event) : void
  -onBack(ActionEvent event) : void
}
class SignupController {
  -count : int
  -onCreate() : void
  #Thread(() : new
}
class WinController {
  +onShowRankings(ActionEvent e) : void
}
class GameEventBus {
  -INSTANCE : return
  -handler : Consumer<Object>
  +publish(Object event) : void
}
class Subscription 
class Ball {
  -radius : double
  -isMoving : boolean
  -isStuck : boolean
  -stuckOffsetX : double
  -isStuck : return
  -stuckOffsetX : return
  -x : return
  -y : return
  -radius : return
  -isMoving : return
  +setCenter(double cx, double cy) : void
  +update(double dt) : void
  +left() : double
  +right() : double
  +top() : double
  +bottom() : double
}
class Brick {
  -health : int
  -health : return
}
class Bullet 
class DoorType
class Enemy {
  -zigzagTimer : double
  -zigzagTimer : return
  -type : return
  -dx : return
  -dy : return
}
class EnemyType 
class GameObject {
  -width : return
  -height : return
  +setPosition(double x, double y) : void
  +setSize(double w, double h) : void
}
class GameState {
  +score : int
  +highScore : int
  +lives : int
  +level : int
  +gameCompleted : boolean
  +gameOver : boolean
  +running : boolean
  +paused : boolean
  +levelTransitionPending : boolean
  +timeScale : double
  +basePaddleWidth : double
  +basePaddleSpeed : double
  +laserCooldown : double
  +resetForLife() : void
  +resetForLevel() : void
  +decrementScore(int amount) : void
  +decrementLives() : void
  +incrementLives() : void
}
class GameStateSnapshot {
  +currentLevel : int
  +paddleX : double
  +ballX : double
  +ballY : double
  +ballDx : double
  +ballDy : double
  +ballMoving : boolean
  +ballDownward : boolean
  +ballStuck : boolean
  +ballStuckOffsetX : double
  +paddleWidth : double
  +type : String
  +remaining : double
  +x : double
  +y : double
  +health : int
  +collected : boolean
  +dx : double
  +dy : double
  +moving : boolean
  +radius : double
  -hp : int
  -snap : return
  -vx : double
  -vy : double
  -moving : boolean
  -speed : double
  -t : double
  -type : PowerUpType
  -base : double
  -b : Brick
  -b0 : BallsState
  -eb : BallsState
  -r : double
  -b : Ball
  -type : EnemyType
  #ActiveEffect() : public
  #ActiveEffect(String type, double remaining) : public
  #BrickState() : public
  #BrickState(double x, double y, int health) : public
  #PowerUpState() : public
  #PowerUpState(String type, double x, double y, boolean collected) : public
  #BallsState() : public
  #BallsState(double x, double y, double dx, double dy, boolean moving, double radius) : public
  #EnemyState() : public
  #EnemyState(String type, double x, double y, double dx, double dy) : public
  +from(GameState s) : GameStateSnapshot
  +applyTo(GameState s) : void
}
class InputState {
  +left : boolean
  +right : boolean
  +launch : boolean
  +fire : boolean
  +pause : boolean
}
class MovableObject {
  #move(double dt) : void
  +setVelocity(double dx, double dy) : void
}
class Paddle {
  -minWidth : double
  -maxWidth : double
  -speed : return
  -minWidth : return
  -maxWidth : return
  +setWidthBounds(double minW, double maxW) : void
}
class PowerUp {
  -collected : boolean
  -collected : return
  +markCollected() : void
}
class PowerUpType
class RankingEntry
class User 
class GameStateRepository {
  -idx : int
  -updated : int
  -s : GameStateSnapshot
  -bricksJson : String
  -powerupsJson : String
  -enemiesJson : String
  -ballsJson : String
  -effectsJson : String
  -sql : String
  -i : int
  -i : return
  -sb : StringBuilder
  -b : GameStateSnapshot.BrickState
  -s : String
  -objs : String[]
  -obj : String
  -x : double
  -y : double
  -p : GameStateSnapshot.PowerUpState
  -type : String
  -e : GameStateSnapshot.EnemyState
  -dx : double
  -dy : double
  -b : GameStateSnapshot.BallsState
  -ef : GameStateSnapshot.ActiveEffect
  -rem : double
  -s : return
  -j : int
  -sub : String
  +upsertInProgress(int userId, GameStateSnapshot snap) : void
  +findLatestInProgress(int userId) : Optional<GameStateSnapshot>
  +clearInProgressForUser(int userId) : void
  -insert(Connection c, int userId, GameStateSnapshot s) : void
  -update(Connection c, int id, GameStateSnapshot s) : void
  -bind(PreparedStatement ps, int userId, GameStateSnapshot s) : void
  -bindCore(PreparedStatement ps, GameStateSnapshot s) : int
  #bindCore(ps, s, 1) : return
  -bindCore(PreparedStatement ps, GameStateSnapshot s, int startIdx) : int
  #encodeBricks(GameStateSnapshot s) : String
  #decodeBricks(String json, GameStateSnapshot out) : void
  #encodePowerUps(GameStateSnapshot s) : String
  #decodePowerUps(String json, GameStateSnapshot out) : void
  #encodeEnemies(GameStateSnapshot s) : String
  #decodeEnemies(String json, GameStateSnapshot out) : void
  #encodeBalls(GameStateSnapshot s) : String
  #decodeBalls(String json, GameStateSnapshot out) : void
  #encodeEffects(GameStateSnapshot s) : String
  #decodeEffects(String json, GameStateSnapshot out) : void
  -escape(String s) : String
  -trim(double d) : String
  -readDouble(String src, String key) : double
  -readString(String src, String key) : String
  -readBoolean(String src, String key) : boolean
}
class ScoreRepository {
  -list : List<RankingEntry>
  -list : return
  +fetchRankings(int limit) : List<RankingEntry>
}
class UserRepository {
  -false : return
  -id : int
  -name : String
  -pass : String
  -ts : Timestamp
  -lastLogin : LocalDateTime
  +findByName(String name) : Optional<User>
  +findByNameInsensitive(String name) : Optional<User>
  +updatePasswordHash(int userId, String newHash) : void
  +tryUpdateName(int userId, String newName) : boolean
  +insert(String name, String passwordHash) : User
  #mapUser(rs) : return
  +updateBest(int userId, int bestRound, int bestScore) : void
  -mapUser(ResultSet rs) : User
}
class BallService {
  -check : boolean
  -oL : double
  -oT : double
  -oR : double
  -oB : double
  -penLeft : double
  -penRight : double
  -penTop : double
  -penBottom : double
  -minPen : double
  -paddle : Paddle
  -paddleX : double
  -paddleW : double
  -collisionX : double
  -paddleH : double
  -ballX : double
  -relX : double
  -offset : double
  -cornerRadius : double
  -hitLeftCorner : boolean
  -hitRightCorner : boolean
  -minAngle : double
  -maxAngle : double
  -angle : double
  -paddleDx : double
  -influence : double
  -cx : double
  -cy : double
  -nearestX : double
  -nearestY : double
  -ddx : double
  -ddy : double
  -target : double
  +launch(Ball ball) : void
  +step(Ball ball, double dt) : void
  +bounceWorld(Ball ball, double worldW, double worldH) : void
  +fellBelow(Ball ball, double worldH) : boolean
  +resetOnPaddle(Ball ball, Paddle paddle) : void
  +bounceOff(Ball ball, GameObject other) : void
  +checkCollision(Ball ball, GameObject other) : boolean
  -ensureMinimumSpeed(Ball ball) : void
  -baseSpeed() : double
}
class BricksService {
  -bricksRemaining : int
  -createdBricks : List<Brick>
  -brickHealth : int
  -brickX : double
  -brickY : double
  -createdBricks : return
  -lines : List<String>
  -bricks : List<Brick>
  -line : String
  -tokens : String[]
  -maxCols : int
  -token : String
  -bricks : return
  -true : return
  -bricksRemaining : return
  -out : List<String>
  -out : return
  +createBricksFromLayout(int[][] layout) : List<Brick>
  +createBricksFromResource(String resourcePath) : List<Brick>
  -countAlive(List<Brick> bricks) : int
  +handleBrickHit(Brick brick) : boolean
  +allBricksCleared(List<Brick> bricks) : boolean
  +recalculateBricksRemaining(List<Brick> bricks) : void
  -readResourceLines(String resourcePath) : List<String>
}
class BulletService {
  -width : double
  -height : double
  -leftX : double
  -rightX : double
  -impacts : List<Impact>
  -iterator : Iterator<Bullet>
  -bullet : Bullet
  -hit : Brick
  -destroyed : boolean
  -impacts : return
  -brick : return
  -null : return
  -bL : double
  -bT : double
  -bR : double
  -bB : double
  +Impact(Brick brick, boolean destroyed) : record
  +tickCooldown(GameState state, double dt) : void
  +tryFire(GameState state, Paddle paddle) : boolean
  +update(GameState state, List<Brick> bricks, double dt, double worldH) : List<Impact>
  -firstHit(List<Brick> bricks, Bullet bullet) : Brick
  -intersects(Bullet bullet, Brick brick) : boolean
}
class DatabaseService {
  -t : Thread
  -t : return
  -unameNorm : String
  -found : Optional<User>
  -computed : String
  -u : return
  -hash : String
  +initializeSchema() : java.util.concurrent.CompletableFuture<Void>
  +login(String username, String password) : CompletableFuture<User>
  #runAsync(() : return
  +loadInProgressState(int userId) : CompletableFuture<Optional<GameStateSnapshot>>
  +saveInProgress(int userId, GameStateSnapshot snap) : CompletableFuture<Void>
  +clearInProgress(int userId) : CompletableFuture<Void>
  +updateBest(int userId, int bestRound, int bestScore) : CompletableFuture<Void>
  +getRankings(int limit) : CompletableFuture<List<RankingEntry>>
  +signup(String username, String password) : CompletableFuture<User>
  +shutdown() : void
}
class EnemyService {
  -types : EnemyType[]
  -initialVx : double
  -enemy : Enemy
  -toRemove : List<Enemy>
  -toRemoveBullets : List<Bullet>
  -ballLeft : double
  -ballRight : double
  -ballTop : double
  -ballBottom : double
  -enemyLeft : double
  -enemyRight : double
  -enemyTop : double
  -enemyBottom : double
  -overlapLeft : double
  -overlapRight : double
  -overlapTop : double
  -overlapBottom : double
  -minOverlapX : double
  -minOverlapY : double
  -leftBound : double
  -rightBound : double
  -topBound : double
  -collidedY : boolean
  -collidedX : boolean
  +spawnEnemy(GameState state, double x, double y) : void
  +update(GameState state, double dt, double worldW, double worldH) : void
  -applyEnemyEffectOnPaddle(Enemy enemy, GameState state) : void
  -applyEnemyEffectOnBall(Enemy enemy, GameState state, Ball ball) : void
  -fastAllBalls(GameState state) : void
  -handleWallCollision(Enemy enemy, double worldW, double worldH) : void
  -handleBrickCollision(Enemy enemy, GameState state) : void
  -spawnExplosion(Enemy enemy) : void
  -intersects(GameObject a, GameObject b) : boolean
}
class GameService {
  -ballSvc : return
  -paddleSvc : return
  -bricksSvc : return
  -powerUpSvc : return
  -bulletSvc : return
  -enemySvc : return
  -roundSvc : return
  -boundState : return
  -boundState : GameState
  -scaledDt : double
  -desiredX : double
  -minX : double
  -maxX : double
  -iterator : Iterator<Ball>
  -ball : Ball
  -impacts : List<BulletService.Impact>
  -brick : Brick
  -spawned : PowerUp
  -alive : int
  -alive : return
  +update(GameState state, InputState in, double dt, double worldW, double worldH) : void
  -handleInput(GameState state, InputState in, double dt, double worldW) : void
  -updateBalls(GameState state, double dt, double worldW, double worldH) : void
  -updateBullets(GameState state, double dt, double worldH) : void
  -handlePaddleCollision(Ball ball, GameState state) : void
  -handleBrickCollisions(Ball ball, GameState state) : void
  -handleBallFall(GameState state) : void
  -processDestroyedBrick(GameState state, Brick brick) : void
  -checkLevelCleared(GameState state) : void
  -countAliveBricks(GameState state) : int
  +restartLevel(GameState state) : void
  +loadNextLevel(GameState state) : void
  +startNextLevel(GameState state) : void
  +loadLevel(GameState state, int levelIndex) : void
  +bindState(GameState state) : void
}
class PaddleService {
  +moveLeft(Paddle paddle, double dt, double worldW) : void
  +moveRight(Paddle paddle, double dt, double worldW) : void
  +clampWithin(Paddle paddle, double worldW) : void
  +stop(Paddle paddle) : void
  +scaleWidth(Paddle paddle, double factor, double worldW) : void
  +resetPaddlePosition(Paddle paddle) : void
}
class PowerUpService {
  -types : PowerUpType[]
  -spawnX : double
  -spawnY : double
  -toRemove : List<PowerUp>
  -px1 : double
  -py1 : double
  -px2 : double
  -py2 : double
  -ox1 : double
  -oy1 : double
  -ox2 : double
  -oy2 : double
  -baseSpeed : double
  -angles : double[]
  -extra : Ball
  -rad : double
  -iterator : Iterator<PowerUpType>
  -remaining : double
  +spawnPowerUpIfAny(double x, double y, double width) : PowerUp
  -intersects(PowerUp powerUp, Paddle paddle) : boolean
  -applyPowerUp(GameState state, PowerUpType type, double worldW) : void
  -spawnAdditionalBalls(GameState state) : void
  -clampPaddle(Paddle paddle, double worldW) : void
  -tickActiveEffects(GameState state, double dt, double worldW) : void
  -onEffectExpired(GameState state, PowerUpType type, double worldW) : void
}
class RoundService {
  -resource : String
  -nextIndex : int
}
class Constants 
class PasswordHasher {
  -username : return
  -salted : String
  -md : MessageDigest
  -digest : byte[]
  +normalize(String username) : String
  +hash(String username, String plain) : String
  #toHex(digest) : return
  +verify(String username, String plain, String expectedHash) : boolean
  #hash(username, plain) : return
  -toHex(byte[] bytes) : String
}
class SqlLoader {
  -in : InputStream
  +load(String resourcePath) : String
}
class MenuAnimator {
  -oldOrder : List<Button>
  -first : Button
  -last : Button
  -n : int
  -btn : Button
  -newButton : Button
  -targetX : double
  -targetY : double
  -isLast : boolean
  -deltaX : double
  -deltaY : double
  -tt : TranslateTransition
  -center : Button
  -sorted : List<Button>
  -centerIndex : int
  -b : Button
  -distance : int
  +moveLeft() : void
  +moveRight() : void
  -animateAll(List<Button> oldOrder) : void
  -animateMove(Button btn, double newX, double newY, Runnable onFinished) : void
  -postMoveUpdate() : void
  -updateHighlight() : void
  -updateVisibility() : void
}
class BallsRenderer {
  -node : ImageView
  -view : ImageView
  -diameter : double
  -view : return
  +render(List<Ball> balls) : void
  -createNode(Ball ball) : ImageView
}
class BricksRenderer {
  -snapshot : List<Brick>
  -iv : ImageView
  -brick9Img : return
  +render(List<Brick> bricks) : void
  -getBrickImage(Brick b) : Image
  #switch(b.getHealth()) : return
}
class BulletRenderer {
  +render(List<Bullet> bullets) : void
  -createNode(Bullet bullet) : ImageView
}
class DoorTopRenderer {
  -iv : return
  -timeline : Timeline
  -pane : return
  -createImageView(ImageView edge_top, Image img) : ImageView
  +playLeftDoor(Runnable onFinished) : void
  #KeyFrame(Duration.millis(i * 160) : new
  +playLeftReverseDoor(Runnable onFinished) : void
  +playRightDoor(Runnable onFinished) : void
  +playRightReverseDoor(Runnable onFinished) : void
  +render(Void v) : void
}
class EnemyRenderer {
  -elapsedTime : double
  -frames : Image[]
  -imageView : ImageView
  -imageView : return
  -lastTime : long
  -delta : double
  -currentFrame : int
  -it : Iterator<Explosion>
  -exp : Explosion
  -frameIndex : int
  -elapsed : double
  -loadFrames() : void
  -subscribeToExplosionEvent() : void
  +playExplosion(double x, double y, double width, double height) : void
  +render(List<Enemy> enemies) : void
  -createEnemyNode(Enemy enemy) : ImageView
  -startAnimation() : void
  #AnimationTimer() : new
}
class LifeRenderer {
  -lastLifeCount : int
  -displayLives : int
  -icon : ImageView
  -lifeBox : return
  +reset() : void
  +render(Integer lives) : void
}
class PaddleRenderer {
  -currentAnimation : Timeline
  -elapsedExpand : double
  -elapsedShrink : double
  -elapsedLaser : double
  -isTransforming : boolean
  -node : return
  -frame : Image
  +registerEventListeners() : void
  +onPowerUpActivated(PowerUpActivatedEvent event) : void
  +onPowerUpExpired(PowerUpExpiredEvent event) : void
  +render(Paddle paddle) : void
  +playIntro(Runnable onFinished) : void
  +playExplosion() : void
  -publishExplodeFinishedEvent() : void
  +startPulsate() : void
  +playExpand(Runnable onFinished) : void
  +startWidePulsate() : void
  +playShrink(Runnable onFinished) : void
  +playLaser(Runnable onFinished) : void
  +startLaserPulsate() : void
  +stopAnimation() : void
  -playFrameSequence(List<Image> frames, double frameDurationMs, boolean loop, Runnable onFinished) : void
  #KeyFrame(Duration.millis(i * frameDurationMs) : new
}
class PowerUpRenderer {
  -frames : return
  -p : PowerUp
  -loadSprites() : void
  -loadFrames(String name) : Image[]
  +render(List<PowerUp> powerUps) : void
  -createNode(PowerUp powerUp) : ImageView
}
class Renderer {
  #render(Model model) : void
}
class SoundManager {
  -instance : SoundManager
  -bgmPlayer : MediaPlayer
  -media : Media
  -clip : AudioClip
  -loadSounds() : void
  -loadBGM(String key, String path) : void
  -loadSFX(String key, String path) : void
  -playBGM(String key) : void
  -stopBGM() : void
  -playSFX(String key) : void
  +masterVolumeProperty() : DoubleProperty
  +musicVolumeProperty() : DoubleProperty
  +sfxVolumeProperty() : DoubleProperty
  +dispose() : void
}
class BlurFadeStrategy {
  -blur : GaussianBlur
  -fade : FadeTransition
  +play(Node root, Runnable onFinished) : void
  #KeyFrame(Duration.ZERO, new KeyValue(blur.radiusProperty() : new
  #KeyFrame(duration, new KeyValue(blur.radiusProperty() : new
}
class FadeTransitionStrategy 
class SlideFadeStrategy {
  -slide : TranslateTransition
  -fade : javafx.animation.FadeTransition
  -parallel : ParallelTransition
}
class TransitionFactory {
  +forMenuScene() : TransitionStrategy
  +forGameScene() : TransitionStrategy
  +forGameOverScene() : TransitionStrategy
  +forWinScene() : TransitionStrategy
  +forSettingsScene() : TransitionStrategy
  +forLevelBanner() : TransitionStrategy
  +forLevelScene() : TransitionStrategy
}
class TransitionManager {
  +menuTransition() : TransitionStrategy
  +gameTransition() : TransitionStrategy
  +gameOverTransition() : TransitionStrategy
  +winTransition() : TransitionStrategy
  +settingsTransition() : TransitionStrategy
  +levelBannerTransition() : TransitionStrategy
  +levelTransition() : TransitionStrategy
  +play(Node root, TransitionStrategy strategy, Runnable onFinished) : void
}
class TransitionStrategy {
  #play(Node root, Runnable onFinished) : void
}
Application <|-- Main
AutoCloseable <|.. Subscription
MovableObject <|-- Ball
GameObject <|-- Brick
MovableObject <|-- Bullet
MovableObject <|-- Enemy
GameObject <|-- MovableObject
MovableObject <|-- Paddle
MovableObject <|-- PowerUp
Renderer <|..> BallsRenderer
Renderer <|..> BricksRenderer
Renderer <|.. BulletRenderer
Renderer <|.. DoorTopRenderer
Renderer <|.. EnemyRenderer
Renderer <|.. LifeRenderer
Renderer <|.. PaddleRenderer
Renderer <|..> PowerUpRenderer
TransitionStrategy <|.. BlurFadeStrategy
TransitionStrategy <|.. FadeTransitionStrategy
TransitionStrategy <|.. SlideFadeStrategy
Main o-- SceneController
AppContext o-- User
Container o-- BallService
Container o-- BricksService
Container o-- BulletService
Container o-- EnemyService
Container o-- PaddleService
Container o-- PowerUpService
Container o-- RoundService
Container o-- SoundManager
GameController o-- BallsRenderer
GameController o-- BricksRenderer
GameController o-- BulletRenderer
GameController o-- DoorTopRenderer
GameController o-- DoorType
GameController o-- EnemyRenderer
GameController o-- GameStateSnapshot
GameController o-- InputState
GameController o-- LifeRenderer
GameController o-- PaddleRenderer
GameController o-- PowerUpRenderer
GameController o-- User
MenuController o-- GameStateSnapshot
MenuController o-- MenuAnimator
MenuController o-- User
SceneController o-- AppContext
SceneController o-- Container
SceneController o-- GameController
SceneController o-- GameStateSnapshot
SceneController o-- User
SettingsController o-- Difficulty
GameStateSnapshot o-- Ball
GameStateSnapshot o-- Brick
GameStateSnapshot o-- EnemyType
GameStateSnapshot o-- PowerUpType
GameStateRepository o-- GameStateSnapshot
ScoreRepository o-- RankingEntry
BallService o-- Paddle
BricksService o-- Brick
BulletService o-- Brick
BulletService o-- Bullet
DatabaseService o-- User
EnemyService o-- Bullet
EnemyService o-- Enemy
EnemyService o-- EnemyType
GameService o-- Ball
GameService o-- Brick
GameService o-- BulletService
GameService o-- GameState
GameService o-- PowerUp
PowerUpService o-- Ball
PowerUpService o-- PowerUp
PowerUpService o-- PowerUpType
RoundService o-- Brick
BricksRenderer o-- Brick
PowerUpRenderer o-- PowerUp
AppContext --> DatabaseService : uses
GameController --> SceneId : uses
GameController --> TransitionStrategy : uses
RankingsController --> RankingEntry : uses
SceneController --> SceneId : uses
SceneController --> TransitionManager : uses
SceneController --> TransitionStrategy : uses
GameStateSnapshot --> GameState : uses
UserRepository --> User : uses
BallService --> Ball : uses
BallService --> GameObject : uses
BulletService --> GameState : uses
BulletService --> Paddle : uses
DatabaseService --> GameStateSnapshot : uses
DatabaseService --> RankingEntry : uses
EnemyService --> Ball : uses
EnemyService --> GameObject : uses
EnemyService --> GameState : uses
GameService --> InputState : uses
PaddleService --> Paddle : uses
PowerUpService --> GameState : uses
PowerUpService --> Paddle : uses
RoundService --> GameState : uses
BallsRenderer --> Ball : uses
BulletRenderer --> Bullet : uses
EnemyRenderer --> Enemy : uses
PaddleRenderer --> Paddle : uses
TransitionFactory --> TransitionStrategy : uses
TransitionManager --> TransitionStrategy : uses
=======
direction TB
    class Main {
	    -navigator : SceneController
	    +start(stage: Stage) : void
	    +main(args: String[]) : void
    }

    class SceneController {
	    +navigateTo(id: SceneId, t: TransitionStrategy) : void
	    +showMenu() : void
	    +showSettings() : void
	    +showGame() : void
	    +showGameRound(round: int) : void
	    +startGameFromSnapshot(snap: GameStateSnapshot) : void
	    +showGameOver() : void
	    +showWin() : void
	    +showLogin() : void
	    +showSignup() : void
	    +showRankings() : void
	    +saveInProgressIfAny() : void
	    +exit() : void
    }

    class GameController {
	    -gameService : GameService
	    -gameState : GameState
	    +initialize() : void
	    +applySnapshot(snap: GameStateSnapshot) : void
	    +resumeWithCountdown() : void
	    +isResumable() : boolean
	    +captureSnapshot() : GameStateSnapshot
	    +stop() : void
	    +getScore() : int
    }

    class MenuController {
	    +onStartGame(e: ActionEvent) : void
	    +onContinueGame(e: ActionEvent) : void
	    +onOpenSettings(e: ActionEvent) : void
	    +onShowRanking(e: ActionEvent) : void
	    +onExit(e: ActionEvent) : void
    }

    class LoginController {
	    +onLogin(e: ActionEvent) : void
	    +onBack(e: ActionEvent) : void
    }

    class SignupController {
	    +onSignup(e: ActionEvent) : void
	    +onBack(e: ActionEvent) : void
    }

    class SettingsController {
	    +initialize() : void
	    +onBack(e: ActionEvent) : void
    }

    class RankingsController {
	    +initialize() : void
    }

    class PauseController {
	    +onResume(e: ActionEvent) : void
	    +onRestart(e: ActionEvent) : void
	    +onExit(e: ActionEvent) : void
    }

    class GameOverController {
	    +onPlayAgain(e: ActionEvent) : void
	    +onMainMenu(e: ActionEvent) : void
    }

    class WinController {
	    +onShowRankings(e: ActionEvent) : void
	    +onMainMenu(e: ActionEvent) : void
    }

    class GameService {
	    +update(state: GameState, in: InputState, dt: double, worldW: double, worldH: double) : void
	    +restartLevel(state: GameState) : void
	    +loadNextLevel(state: GameState) : void
	    +startNextLevel(state: GameState) : void
	    +loadLevel(state: GameState, levelIndex: int) : void
	    +bindState(state: GameState) : void
	    +getEnemyService() : EnemyService
    }

    class BallService {
	    +launch(ball: Ball) : void
	    +step(ball: Ball, dt: double) : void
	    +bounceWorld(ball: Ball, worldW: double, worldH: double) : void
	    +fellBelow(ball: Ball, worldH: double) : boolean
	    +resetOnPaddle(ball: Ball, paddle: Paddle) : void
	    +bounceOff(ball: Ball, other: GameObject) : void
    }

    class PaddleService {
	    +moveLeft(p: Paddle, dt: double, worldW: double) : void
	    +moveRight(p: Paddle, dt: double, worldW: double) : void
	    +clampWithin(p: Paddle, worldW: double) : void
	    +stop(p: Paddle) : void
	    +scaleWidth(p: Paddle, factor: double, worldW: double) : void
	    +resetPaddlePosition(p: Paddle) : void
    }

    class BricksService {
	    +createBricksFromLayout(layout: int[][]) : List
	    +createBricksFromResource(resourcePath: String) : List
	    +handleBrickHit(brick: Brick) : boolean
	    +allBricksCleared(bricks: List) : boolean
	    +getBricksRemaining() : int
	    +recalculateBricksRemaining(bricks: List) : void
    }

    class BulletService {
	    +tickCooldown(state: GameState, dt: double) : void
	    +tryFire(state: GameState, paddle: Paddle) : boolean
	    +update(state: GameState, bricks: List, dt: double, worldH: double) : List
    }

    class PowerUpService {
	    +spawnPowerUpIfAny(x: double, y: double, width: double) : PowerUp
	    +update(state: GameState, dt: double, worldW: double, worldH: double) : void
    }

    class EnemyService {
	    +spawnEnemy(state: GameState, x: double, y: double) : void
	    +update(state: GameState, dt: double, worldW: double, worldH: double) : void
    }

    class RoundService {
	    +loadLevel(state: GameState, levelIndex: int) : void
	    +loadNextLevel(state: GameState) : void
    }

    class DatabaseService {
	    +initializeSchema() : CompletableFuture
	    +login(username: String, password: String) : CompletableFuture
	    +signup(username: String, password: String) : CompletableFuture
	    +getRankings(limit: int) : CompletableFuture
	    +loadInProgressState(userId: int) : CompletableFuture
	    +saveInProgress(userId: int, snap: GameStateSnapshot) : CompletableFuture
	    +clearInProgress(userId: int) : CompletableFuture
	    +updateBest(userId: int, bestRound: int, bestScore: int) : CompletableFuture
	    +shutdown() : void
    }

    class GameState {
	    +ball : Ball
	    +paddle : Paddle
	    +bricks : List
	    +balls : List
	    +bullets : List
	    +powerUps : List
	    +enemies : List
	    +activePowerUps : Map
	    +score : int
	    +highScore : int
	    +lives : int
	    +level : int
	    +running : boolean
	    +paused : boolean
	    +levelTransitionPending : boolean
	    +timeScale : double
	    +basePaddleWidth : double
	    +basePaddleSpeed : double
	    +laserCooldown : double
	    +resetForLife() : void
	    +resetForLevel() : void
	    +decrementScore(amount: int) : void
	    +decrementLives() : void
	    +incrementLives() : void
    }

    class GameStateSnapshot {
	    +currentLevel : int
	    +score : int
	    +lives : int
	    +paddleX : double
	    +ballX : double
	    +ballY : double
	    +ballDx : double
	    +ballDy : double
	    +ballMoving : boolean
	    +ballDownward : boolean
	    +ballStuck : boolean
	    +ballStuckOffsetX : double
	    +paddleWidth : double
	    +timeScale : double
	    +laserCooldown : double
	    +from(state: GameState) : GameStateSnapshot
	    +applyTo(state: GameState) : void
    }

    class GameObject {
	    -x : double
	    -y : double
	    -width : double
	    -height : double
	    +update(dt: double) : void
	    +getX() : double
	    +getY() : double
	    +getWidth() : double
	    +getHeight() : double
    }

    class MovableObject {
	    -dx : double
	    -dy : double
	    +update(dt: double) : void
	    +setVelocity(dx: double, dy: double) : void
	    +getDx() : double
	    +getDy() : double
    }

    class Ball {
	    -radius : double
	    +getCenterX() : double
	    +getCenterY() : double
	    +setCenter(x: double, y: double) : void
	    +getRadius() : double
	    +setRadius(r: double) : void
	    +isMoving() : boolean
	    +setMoving(m: boolean) : void
	    +isStuck() : boolean
	    +setStuck(v: boolean) : void
	    +getStuckOffsetX() : double
	    +setStuckOffsetX(v: double) : void
	    +update(dt: double) : void
	    +left() : double
	    +right() : double
	    +top() : double
	    +bottom() : double
    }

    class Paddle {
	    -speed : double
	    -minWidth : double
	    -maxWidth : double
	    +update(dt: double) : void
	    +getSpeed() : double
	    +setSpeed(v: double) : void
	    +setWidthBounds(min: double, max: double) : void
	    +setWidthClamped(w: double) : void
    }

    class Brick {
	    -health : int
	    +update(dt: double) : void
	    +getHealth() : int
	    +setHealth(h: int) : void
	    +isDestroyed() : boolean
	    +isIndestructible() : boolean
    }

    class Bullet {
	    +update(dt: double) : void
	    +top() : double
	    +bottom() : double
	    +left() : double
	    +right() : double
    }

    class PowerUp {
	    -type : PowerUpType
	    -collected : boolean
	    +getType() : PowerUpType
	    +isCollected() : boolean
	    +markCollected() : void
	    +update(dt: double) : void
    }

    class Enemy {
	    -zigzagTimer : double
	    -type : EnemyType
	    +getType() : EnemyType
	    +getVx() : double
	    +setVx(v: double) : void
	    +getVy() : double
	    +setVy(v: double) : void
	    +update(dt: double) : void
    }

    class InputState {
	    +left : boolean
	    +right : boolean
	    +launch : boolean
	    +fire : boolean
    }

    class RankingEntry {
	    -name : String
	    -bestScore : int
	    -bestRound : int
	    +getName() : String
	    +getBestScore() : int
	    +getBestRound() : int
    }

    class User {
	    -id : int
	    -name : String
	    -passwordHash : String
	    -bestScore : int
	    -bestRound : int
	    -lastLogin : LocalDateTime
	    +getId() : int
	    +getName() : String
	    +getPasswordHash() : String
	    +getBestScore() : int
	    +getBestRound() : int
	    +getLastLogin() : LocalDateTime
    }

    class DatabaseConfig {
	    -connection : Connection
	    +getConnection() : Connection
	    +close() : void
    }

    class GameSettings {
	    +isSoundEnabled() : boolean
	    +setSoundEnabled(v: boolean) : void
	    +getMasterVolume() : double
	    +setMasterVolume(v: double) : void
	    +getMusicVolume() : double
	    +setMusicVolume(v: double) : void
	    +getSfxVolume() : double
	    +setSfxVolume(v: double) : void
	    +getDifficulty() : Difficulty
	    +setDifficulty(d: Difficulty) : void
	    +getBallSpeedMultiplier() : double
	    +getPaddleWidthMultiplier() : double
	    +getHighScore() : int
	    +setHighScore(score: int) : void
    }

    class GameEventBus {
	    +getInstance() : GameEventBus
	    +subscribe(type: Class, handler: Consumer) : Subscription
	    +publish(event: Object) : void
    }

    class Renderer~Model~ {
	    +getNode() : Node
	    +render(model: Model) : void
	    +dispose() : void
    }

    class BallRenderer {
	    +render(balls: List) : void
	    +getNode() : ImageView
    }

    class BricksRenderer {
	    +render(bricks: List) : void
	    +getNode() : ImageView
    }

    class BulletRenderer {
	    +render(bullets: List) : void
	    +getNode() : ImageView
    }

    class EnemyRenderer {
	    +render(enemies: List) : void
	    +getNode() : ImageView
    }

    class PaddleRenderer {
	    +render(paddle: Paddle) : void
	    +getNode() : ImageView
    }

    class PowerUpRenderer {
	    +render(powerUps: List) : void
	    +getNode() : ImageView
    }

    class LifeRenderer {
	    +render(lives: Integer) : void
	    +getNode() : Node
    }

    class DoorTopRenderer {
	    +render(Void) : void
	    +getNode() : Pane
    }

    class MenuAnimator {
	    +moveLeft() : void
	    +moveRight() : void
	    +getCenterButton() : Button
    }

    class SoundManager {
	    +playMenuBGM() : void
	    +playGameBGM() : void
	    +playPowerUpHit() : void
	    +stopBGM() : void
    }

    class Button {
    }

    class Container {
    }

    class TransitionManager {
    }

    class TransitionFactory {
    }

    class TransitionStrategy {
    }

    class FadeTransitionStrategy {
    }

    class BlurFadeStrategy {
    }

    class SlideFadeStrategy {
    }

    class UntitledClass {
    }

	<<interface>> Renderer

    GameObject <|-- MovableObject
    MovableObject <|-- Ball
    MovableObject <|-- Paddle
    MovableObject <|-- Bullet
    MovableObject <|-- PowerUp
    MovableObject <|-- Enemy
    Main --> SceneController : uses
    SceneController --> GameController : creates
    SceneController --> MenuController : creates
    SceneController --> SettingsController : creates
    SceneController --> LoginController : creates
    SceneController --> SignupController : creates
    SceneController --> RankingsController : creates
    SceneController --> GameOverController : creates
    SceneController --> WinController : creates
    GameController --> GameService : uses
    GameController --> GameState : uses
    GameController --> SceneController : uses
    GameController ..> GameStateSnapshot : capture/apply
    MenuController ..> DatabaseService : uses
    LoginController ..> DatabaseService : uses
    SignupController ..> DatabaseService : uses
    RankingsController ..> DatabaseService : uses
    GameOverController --> SceneController : navigates
    WinController --> SceneController : navigates
    GameService o-- BallService
    GameService o-- PaddleService
    GameService o-- BricksService
    GameService o-- PowerUpService
    GameService o-- BulletService
    GameService o-- EnemyService
    GameService o-- RoundService
    GameService --> GameState : mutates
    RoundService o-- BricksService
    RoundService o-- BallService
    RoundService o-- PaddleService
    BulletService --> GameState : uses
    BulletService --> Bullet : uses
    BulletService --> Brick : uses
    BallService --> Ball : uses
    BallService --> Paddle : uses
    BallService --> GameObject : uses
    PowerUpService --> GameState : uses
    PowerUpService --> PowerUp : uses
    EnemyService --> GameState : uses
    EnemyService --> Enemy : uses
    BricksService --> Brick : creates
    DatabaseService ..> User : returns
    DatabaseService ..> RankingEntry : returns
    DatabaseService ..> GameStateSnapshot : uses
    GameState --> Ball : has
    GameState --> Paddle : has
    GameState --> Brick : has many
    GameState --> Bullet : has many
    GameState --> PowerUp : has many
    GameState --> Enemy : has many
    Renderer <|.. BallRenderer
    Renderer <|.. BricksRenderer
    Renderer <|.. BulletRenderer
    Renderer <|.. EnemyRenderer
    Renderer <|.. PaddleRenderer
    Renderer <|.. PowerUpRenderer
    Renderer <|.. LifeRenderer
    Renderer <|.. DoorTopRenderer
    BallRenderer --> Ball : renders
    BricksRenderer --> Brick : renders many
    BulletRenderer --> Bullet : renders many
    EnemyRenderer --> Enemy : renders many
    PaddleRenderer --> Paddle : renders
    PowerUpRenderer --> PowerUp : renders many
    LifeRenderer --> GameState : uses lives
    DoorTopRenderer --> GameEventBus : reacts to door events
    SoundManager --> GameEventBus : subscribes
    MenuAnimator --> Button : animates
    GameController --> Renderer : updates visual layer
    MenuController --> MenuAnimator : controls
    Container --> GameSettings : reads config
    SettingsController --> GameSettings : updates
    GameController --> InputState : creates & updates
    GameService --> InputState : reads
    GameController --> GameEventBus : publish & subscribe
    EnemyRenderer --> GameEventBus : subscribe (explosion)
    GameController --> PauseController : uses
    SceneController --> TransitionManager : uses
    TransitionManager *-- TransitionFactory : creates
    TransitionFactory --> TransitionStrategy : returns
    TransitionStrategy <|.. FadeTransitionStrategy
    TransitionStrategy <|.. BlurFadeStrategy
    TransitionStrategy <|.. SlideFadeStrategy
    TransitionStrategy -- UntitledClass

>>>>>>> a0ed4c4de45a0cf98b96750bf5181cfa4b8d91fe
